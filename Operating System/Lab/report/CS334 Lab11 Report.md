### CS334 Lab11 Report

**一个进程有多少个mm_struct? mm_struct的作用是什么？**

一个进程只有一个 `mm_struct`，它的作用是将一个页表对应的信息组合起来，连接多个`vma_struct`，并且组合这段虚拟地址空间块的对应信息，便于空间管理。

**vma_struct的作用是什么？**

`vma_struct`描述了一段连续的虚拟地址，用来管理虚拟地址空间以及维护相应的内存空间的权限

**什么情况下会出触发缺页中断？**

在访问虚拟地址的时候，这个虚拟地址没有对应的物理地址，这样就会触发缺页中断。

- 页表中没有虚拟地址对应的`PTE`，可能是虚拟地址无效或者虚拟地址有效但是还没分配物理内存页
- 访问该`PTE`的权限不足

**major page fault是如何处理的？在实验代码中对应哪一段？**

需要将交换区的页面重新载入内存，对应实验代码中的` kern/mm/vmm.c` 当中的 `do_pgfault`函数中的以下这段。

![image-20220722105927886](C:\Users\86181\AppData\Roaming\Typora\typora-user-images\image-20220722105927886.png)

**swap_in和swap_out分别发生在什么时候？**

`swap_in`发生在页表项不为0 的时候，此时说明对应的页面被换出，需要根据 `PTE`在硬盘上面找到对应的页面，并且将其换入，建立映射，最后标记这个页面是可以换出的。

`swap_out`发生在当页表项为0，需要分配一个新的物理页面，且分配时物理内存满了的时候，此时就需要换出操作，将页面换出，给新的页面预留空间。